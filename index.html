<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸˆ AniPangâ€‘style Matchâ€‘3</title>
<style>
  :root{
    --bg:#fff8f0;
    --panel:#ffffff;
    --border:#fcd9b8;
    --text:#4b2e05;
    --muted:#a17441;
    --accent:#ffb86b;
    --accent-2:#ff9f43;
    --radius:16px;
    --shadow:0 10px 24px rgba(0,0,0,.12);
    --cell:64px;           /* ê¸°ë³¸ ì…€ í¬ê¸° */
    --gap:8px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:"Pretendard","Segoe UI",system-ui,-apple-system,Arial;
    display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .app{width:min(1100px,96vw)}
  header{
    background:var(--panel); border:3px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:16px 20px; margin-bottom:16px;
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
  }
  .brand{display:flex; align-items:center; gap:12px}
  .logo{width:48px; height:48px; border-radius:14px; display:grid; place-items:center;
    background:conic-gradient(from 210deg,#ff9f43,#ff6b6b,#f78fb3,#70c1ff,#51e5a8,#ff9f43)}
  h1{margin:0; font-size:20px}
  .muted{color:var(--muted); font-size:13px}
  select,button{
    border:2px solid var(--border); border-radius:12px; background:#fff; padding:8px 12px; font-weight:700; cursor:pointer;
    box-shadow:0 3px 0 #e08e37; color:#7a4a1a
  }
  button.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#3b2206; border:none}
  .stats{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .tag{background:#fff3e6; border:2px solid var(--border); border-radius:12px; padding:6px 10px; font-variant-numeric:tabular-nums}

  .board-wrap{display:flex; gap:16px; align-items:flex-start; justify-content:center; flex-wrap:wrap}
  .board{
    display:grid; gap:var(--gap); background:var(--panel); padding:14px; border:3px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
    touch-action:manipulation;
  }
  .cell{
    width:var(--cell); height:var(--cell); border-radius:14px; display:grid; place-items:center;
    user-select:none; cursor:pointer; position:relative; transition:transform .08s ease;
  }
  .cell:active{transform:scale(.96)}
  .bubble{position:absolute; inset:0; border-radius:14px; box-shadow:inset 0 6px 0 rgba(255,255,255,.45), inset 0 -6px 0 rgba(0,0,0,.06)}
  /* ìƒ‰ìƒë³„ ì ¤ë¦¬ ìŠ¤íƒ€ì¼ */
  .c0{background:radial-gradient(120% 120% at 30% 25%,#fff 0%,rgba(255,255,255,.6) 12%,rgba(255,255,255,0) 35%), linear-gradient(180deg,#ff9f43,#ff6b3d)}
  .c1{background:radial-gradient(120% 120% at 30% 25%,#fff 0%,rgba(255,255,255,.6) 12%,rgba(255,255,255,0) 35%), linear-gradient(180deg,#70c1ff,#3aa0ff)}
  .c2{background:radial-gradient(120% 120% at 30% 25%,#fff 0%,rgba(255,255,255,.6) 12%,rgba(255,255,255,0) 35%), linear-gradient(180deg,#51e5a8,#1fcf7c)}
  .c3{background:radial-gradient(120% 120% at 30% 25%,#fff 0%,rgba(255,255,255,.6) 12%,rgba(255,255,255,0) 35%), linear-gradient(180deg,#f78fb3,#f05f93)}
  .c4{background:radial-gradient(120% 120% at 30% 25%,#fff 0%,rgba(255,255,255,.6) 12%,rgba(255,255,255,0) 35%), linear-gradient(180deg,#ffd166,#f2b01b)}
  .c5{background:radial-gradient(120% 120% at 30% 25%,#fff 0%,rgba(255,255,255,.6) 12%,rgba(255,255,255,0) 35%), linear-gradient(180deg,#c4b5fd,#8b5cf6)}

  /* ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes pop { from{transform:scale(1)} 50%{transform:scale(1.12)} to{transform:scale(1)} }
  .match{animation:pop .25s ease}
  .vanish{animation: vanish .22s ease forwards}
  @keyframes vanish { to{transform:scale(.2); opacity:0} }
  .shake{animation:shake .2s ease}
  @keyframes shake{10%,90%{transform:translateX(-2px)} 20%,80%{transform:translateX(2px)} 30%,50%,70%{transform:translateX(-2px)} 40%,60%{transform:translateX(2px)}}

  .panel{
    flex:1 1 260px; background:var(--panel); border:3px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:14px; min-width:260px
  }
  .objective{font-weight:700}

  @media (max-width: 520px){ :root{ --cell:48px; --gap:6px } }
  @media (max-width: 380px){ :root{ --cell:42px; --gap:6px } }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">ğŸ¬</div>
        <div>
          <h1>ì• ë‹ˆíŒ¡ ëŠë‚Œì˜ ë§¤ì¹˜â€‘3</h1>
          <div class="muted">ì¸ì ‘í•œ ë‘ ë¸”ë¡ì„ êµí™˜í•´ ê°™ì€ ìƒ‰ 3ê°œ ì´ìƒì„ ë§ì¶”ë©´ í„°ì§‘ë‹ˆë‹¤!</div>
        </div>
      </div>
      <div class="controls">
        <select id="mode">
          <option value="7x7x25x2500">ì‰¬ì›€ Â· 7Ã—7 Â· 25 Moves Â· ëª©í‘œ 2,500</option>
          <option value="8x8x25x3500" selected>ë³´í†µ Â· 8Ã—8 Â· 25 Moves Â· ëª©í‘œ 3,500</option>
          <option value="9x9x20x5000">ì–´ë ¤ì›€ Â· 9Ã—9 Â· 20 Moves Â· ëª©í‘œ 5,000</option>
        </select>
        <button id="new" class="primary">ìƒˆ ê²Œì„</button>
      </div>
      <div class="stats">
        <div class="tag">ì ìˆ˜ <b id="score">0</b></div>
        <div class="tag">ë‚¨ì€ ì´ë™ <b id="moves">0</b></div>
        <div class="tag">ëª©í‘œ <b id="target">0</b></div>
      </div>
    </header>

    <div class="board-wrap">
      <div class="board" id="board" role="grid" aria-label="Match-3 Board"></div>
      <div class="panel">
        <p class="objective">ğŸ¯ ëª©í‘œ ì ìˆ˜ë¥¼ ì´ë™ ìˆ˜ ì•ˆì— ë‹¬ì„±í•˜ì„¸ìš”.</p>
        <ul>
          <li>ê°™ì€ ìƒ‰ <b>3ê°œ ì´ìƒ</b>ì´ ê°€ë¡œ/ì„¸ë¡œë¡œ ì—°ê²°ë˜ë©´ í„°ì§‘ë‹ˆë‹¤.</li>
          <li>í•œ ë²ˆì— ë§ì´ í„°ëœ¨ë¦´ìˆ˜ë¡ <b>ì½¤ë³´ ë³´ë„ˆìŠ¤</b>!</li>
          <li>í„°ì§„ ìë¦¬ ìœ„ì—ì„œ ë¸”ë¡ì´ ë‚´ë ¤ì˜¤ê³ , ìœ„ì—ì„œ ìƒˆ ë¸”ë¡ì´ ì±„ì›Œì§‘ë‹ˆë‹¤.</li>
          <li>ìœ íš¨í•˜ì§€ ì•Šì€ êµí™˜ì€ ì›ë˜ëŒ€ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</li>
        </ul>
        <p class="muted">Tip: ë³´ë“œì— ê°€ëŠ¥í•œ êµí™˜ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ì„ì…ë‹ˆë‹¤.</p>
      </div>
    </div>
  </div>

<script>
(()=>{
  const boardEl = document.getElementById('board');
  const scoreEl = document.getElementById('score');
  const movesEl = document.getElementById('moves');
  const targetEl = document.getElementById('target');
  const modeEl = document.getElementById('mode');
  const newBtn = document.getElementById('new');

  let rows=8, cols=8, moves=25, target=3500;
  let grid=[]; let selected=null; let animating=false; let score=0;
  const COLORS = [0,1,2,3,4,5]; // 6 ìƒ‰

  function parseMode(){
    const [r,c,m,t] = modeEl.value.split('x').map(Number);
    rows=r; cols=c; moves=m; target=t;
  }

  function init(){
    parseMode();
    score=0; selected=null; animating=false;
    scoreEl.textContent=score; movesEl.textContent=moves; targetEl.textContent=target;

    boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--cell))`;
    boardEl.innerHTML='';
    grid = Array.from({length:rows}, ()=> Array(cols).fill(null));

    // ì±„ìš°ê¸°(ì´ˆê¸°ì—ëŠ” 3ì—°ì†ì´ ì—†ë„ë¡ ê°„ë‹¨íˆ í”¼í•˜ê¸°)
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        let color;
        do{
          color = COLORS[Math.floor(Math.random()*COLORS.length)];
        } while( (c>=2 && grid[r][c-1]===color && grid[r][c-2]===color) ||
                 (r>=2 && grid[r-1][c]===color && grid[r-2][c]===color) );
        grid[r][c] = color;
      }
    }
    renderAll();
    ensureMoveExists();
  }

  function renderAll(){
    boardEl.innerHTML='';
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        boardEl.appendChild(renderCell(r,c));
      }
    }
  }

  function renderCell(r,c){
    const d = document.createElement('div');
    d.className = 'cell c'+grid[r][c];
    d.dataset.r=r; d.dataset.c=c; d.setAttribute('role','gridcell');
    const bubble = document.createElement('div'); bubble.className='bubble'; d.appendChild(bubble);
    d.addEventListener('click', onCellClick);
    d.addEventListener('touchend', onCellClick, {passive:true});
    return d;
  }

  function onCellClick(e){
    if(animating) return;
    const r = +e.currentTarget.dataset.r;
    const c = +e.currentTarget.dataset.c;
    if(!selected){
      selected = {r,c};
      e.currentTarget.classList.add('match');
    }else{
      const {r:sr, c:sc} = selected;
      const adjacent = (Math.abs(sr-r)+Math.abs(sc-c))===1;
      const prevEl = [...boardEl.children].find(el=>+el.dataset?.r===sr && +el.dataset?.c===sc);
      if(prevEl) prevEl.classList.remove('match');
      if(!adjacent){ selected={r,c}; e.currentTarget.classList.add('match'); return; }
      trySwap(sr,sc,r,c);
      selected=null;
    }
  }

  async function trySwap(r1,c1,r2,c2){
    swap(r1,c1,r2,c2);
    updateCell(r1,c1); updateCell(r2,c2);
    const matched = findMatches();
    if(matched.size===0){ // ë˜ëŒë¦¬ê¸°
      const a = getCellEl(r1,c1), b=getCellEl(r2,c2);
      [a,b].forEach(el=>el.classList.add('shake'));
      await sleep(180);
      [a,b].forEach(el=>el.classList.remove('shake'));
      swap(r1,c1,r2,c2);
      updateCell(r1,c1); updateCell(r2,c2);
    } else {
      moves--; movesEl.textContent=moves;
      await resolveMatches(matched, 1);
      if(moves<=0){ endGame(); return; }
      ensureMoveExists();
      checkWin();
    }
  }

  function swap(r1,c1,r2,c2){ const tmp=grid[r1][c1]; grid[r1][c1]=grid[r2][c2]; grid[r2][c2]=tmp; }

  function getCellEl(r,c){ return [...boardEl.children].find(el=>+el.dataset.r===r && +el.dataset.c===c); }
  function updateCell(r,c){ const el=getCellEl(r,c); if(!el) return; el.className='cell c'+grid[r][c]; const b=el.querySelector('.bubble'); if(!b){ const nb=document.createElement('div'); nb.className='bubble'; el.appendChild(nb);} }

  function findMatches(){
    const matched = new Set();
    // rows
    for(let r=0;r<rows;r++){
      let count=1;
      for(let c=1;c<=cols;c++){
        if(c<cols && grid[r][c]===grid[r][c-1]){ count++; }
        else { if(count>=3){ for(let k=0;k<count;k++) matched.add(`${r},${c-1-k}`);} count=1; }
      }
    }
    // cols
    for(let c=0;c<cols;c++){
      let count=1;
      for(let r=1;r<=rows;r++){
        if(r<rows && grid[r][c]===grid[r-1][c]){ count++; }
        else { if(count>=3){ for(let k=0;k<count;k++) matched.add(`${r-1-k},${c}`);} count=1; }
      }
    }
    return matched;
  }

  async function resolveMatches(matched, chain){
    if(matched.size===0) return;
    animating=true;
    // ì ìˆ˜ (ì½¤ë³´ ë³´ì •)
    const base = 100 * matched.size; // ê°œë‹¹ 100ì 
    const bonus = Math.floor((chain-1) * 0.5 * base);
    score += base + bonus; scoreEl.textContent=score;

    // í„°ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜
    matched.forEach(key=>{
      const [r,c]=key.split(',').map(Number);
      const el = getCellEl(r,c);
      if(el){ el.classList.add('vanish'); }
    });
    await sleep(210);

    // ì œê±° + ì¤‘ë ¥
    matched.forEach(key=>{
      const [r,c]=key.split(',').map(Number);
      grid[r][c] = null;
    });

    for(let c=0;c<cols;c++){
      let write = rows-1;
      for(let r=rows-1;r>=0;r--){
        if(grid[r][c]!==null){
          grid[write][c] = grid[r][c];
          if(write!==r){ grid[r][c]=null; }
          write--;
        }
      }
      // ìœ„ì—ì„œ ì±„ìš°ê¸°
      for(let r=write;r>=0;r--){
        grid[r][c] = COLORS[Math.floor(Math.random()*COLORS.length)];
      }
    }
    renderAll();

    // ì—°ì‡„ ë§¤ì¹˜ í™•ì¸
    const next = findMatches();
    animating=false;
    if(next.size>0){ await resolveMatches(next, chain+1); }
  }

  function sleep(ms){ return new Promise(res=>setTimeout(res,ms)); }

  function endGame(){
    setTimeout(()=>{
      const msg = score>=target ? `ğŸ‰ í´ë¦¬ì–´! ì ìˆ˜ ${score}ì  (ëª©í‘œ ${target})` : `ë! ì ìˆ˜ ${score}ì  (ëª©í‘œ ${target})`;
      alert(msg);
    }, 50);
  }

  function checkWin(){ if(score>=target){ endGame(); } }

  // ê°€ëŠ¥í•œ ì´ë™ì´ í•˜ë‚˜ë„ ì—†ëŠ”ì§€ ê°„ë‹¨ ì²´í¬
  function hasPossibleMove(){
    const dir=[[1,0],[-1,0],[0,1],[0,-1]];
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        for(const [dr,dc] of dir){
          const nr=r+dr,nc=c+dc; if(nr<0||nr>=rows||nc<0||nc>=cols) continue;
          swap(r,c,nr,nc);
          if(findMatches().size>0){ swap(r,c,nr,nc); return true; }
          swap(r,c,nr,nc);
        }
      }
    }
    return false;
  }

  function ensureMoveExists(){
    let tries=0;
    while(!hasPossibleMove() && tries<20){
      // ë³´ë“œ ë¬´ì‘ìœ„ ì„ê¸°
      const all=[]; for(let r=0;r<rows;r++)for(let c=0;c<cols;c++) all.push(grid[r][c]);
      all.sort(()=>Math.random()-.5);
      for(let r=0,i=0;r<rows;r++)for(let c=0;c<cols;c++,i++) grid[r][c]=all[i];
      renderAll(); tries++;
    }
  }

  newBtn.addEventListener('click', init);
  modeEl.addEventListener('change', init);

  init();
})();
</script>
</body>
</html>
